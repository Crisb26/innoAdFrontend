services:
  frontend:
    build:
      context: .
      args:
        BUILD_CONFIGURATION: compose
    image: ${front_image:-innoad-frontend:compose}
    container_name: innoad-frontend
    ports:
      - "${FRONTEND_HTTP_PORT:-8080}:80"
    depends_on:
      - backend
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost/"]
      interval: 30s
      timeout: 5s
      retries: 3

  # Backend: ajusta imagen o build seg√∫n tu proyecto real
  backend:
    # Para usar imagen publicada, exporta BACKEND_IMAGE en .env
    image: ${BACKEND_IMAGE:-innoad-backend:latest}
    # Para construir localmente desde otro repo, descomenta y ajusta:
    # build:
    #   context: ../innoadBackend
    #   dockerfile: Dockerfile
    container_name: innoad-backend
    environment:
      - SERVER_PORT=${BACKEND_INTERNAL_PORT:-8080}
      - SPRING_PROFILES_ACTIVE=${SPRING_PROFILES_ACTIVE:-prod}
      - INNOAD_JWT_SECRET=${JWT_SECRET:-change-me}
      - INNOAD_CORS_ALLOWED_ORIGINS=${CORS_ALLOWED_ORIGINS:-http://localhost:8080,http://localhost:4200}
    ports:
      - "${BACKEND_HTTP_PORT:-8081}:${BACKEND_INTERNAL_PORT:-8080}"
    expose:
      - "${BACKEND_INTERNAL_PORT:-8080}"
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "-qO-", "http://localhost:${BACKEND_INTERNAL_PORT:-8080}/actuator/health"]
      interval: 30s
      timeout: 5s
      retries: 5

networks:
  default:
    name: innoad-net
