# üöÄ GU√çA DE DEPLOYMENT - FASE 4 COMPLETADA\n\n**Objetivo:** Desplegar InnoAd con todas las caracter√≠sticas de Fase 4 en producci√≥n.\n\n---\n\n## üîß Pre-Requisitos\n\n### Sistema\n- [x] Docker & Docker Compose instalados\n- [x] Java 21+ (para build local)\n- [x] Node.js 18+ (para frontend)\n- [x] PostgreSQL 15+ (o usar servicio en la nube)\n- [x] Redis 7+ (o usar servicio en la nube)\n\n### Credenciales\n- [x] Azure Subscription (para producci√≥n)\n- [x] OpenAI API Key\n- [x] SMTP credentials (para email)\n- [x] Base de datos credenciales\n\n---\n\n## üèóÔ∏è Opci√≥n 1: Deployment Local con Docker Compose\n\n### 1. Clonar Repositorio\n```bash\ngit clone <repo-url>\ncd PROYECTO FINAL INNOAD\n```\n\n### 2. Configurar Variables de Entorno\n\n**Backend (innoadBackend/.env)**\n```env\n# Database\nDATABASE_URL=jdbc:postgresql://postgres:5432/innoad_db\nDATABASE_USERNAME=postgres\nDATABASE_PASSWORD=your_secure_password\n\n# Redis\nREDIS_HOST=redis\nREDIS_PORT=6379\nREDIS_PASSWORD=\n\n# JWT\nJWT_SECRET=your_super_secret_key_here_must_be_long_and_secure\n\n# OpenAI\nAI_API_KEY=sk-your-openai-key\nAI_MODEL=gpt-4\n\n# Email\nMAIL_HOST=smtp.gmail.com\nMAIL_PORT=587\nMAIL_USERNAME=your-email@gmail.com\nMAIL_PASSWORD=your-app-password\n\n# Admin\nADMIN_PASSWORD=Admin123!SecurePass\n\n# Environment\nSPRING_PROFILES_ACTIVE=prod\n```\n\n**Frontend (innoadFrontend/.env)**\n```env\nAPI_URL=http://localhost:8080\nENVIRONMENT=development\nANGULAR_BUILD_TYPE=production\n```\n\n### 3. Levantar Stack Completo\n\n```bash\n# Desde ra√≠z del proyecto\ndocker-compose up -d\n\n# Ver logs\ndocker-compose logs -f backend\ndocker-compose logs -f frontend\ndocker-compose logs -f postgres\ndocker-compose logs -f redis\n```\n\n### 4. Verificar Servicios\n\n**Backend (Spring Boot)**\n```bash\ncurl http://localhost:8080/api/health\n# Response: {\"status\":\"UP\"}\n```\n\n**Frontend (Angular)**\n```bash\n# Abrir navegador\nhttp://localhost:4200\n```\n\n**PostgreSQL**\n```bash\ndocker exec postgres psql -U postgres -c \"\\l\"\n```\n\n**Redis**\n```bash\ndocker exec redis redis-cli ping\n# Response: PONG\n```\n\n---\n\n## üåê Opci√≥n 2: Deployment en Azure\n\n### 1. Crear Recursos en Azure\n\n```bash\n# Login a Azure\naz login\n\n# Crear resource group\naz group create \\\n  --name innoad-rg \\\n  --location eastus\n\n# Crear App Service (Backend)\naz appservice plan create \\\n  --name innoad-plan \\\n  --resource-group innoad-rg \\\n  --sku B2 \\\n  --is-linux\n\naz webapp create \\\n  --name innoad-backend \\\n  --resource-group innoad-rg \\\n  --plan innoad-plan \\\n  --runtime \"JAVA|21-java21\"\n\n# Crear PostgreSQL\naz postgres flexible-server create \\\n  --name innoad-db \\\n  --resource-group innoad-rg \\\n  --admin-user postgres \\\n  --admin-password 'YourSecurePassword123!'\n\n# Crear Redis Cache\naz redis create \\\n  --name innoad-redis \\\n  --resource-group innoad-rg \\\n  --location eastus \\\n  --sku basic \\\n  --vm-size c0\n\n# Crear Storage (para uploads)\naz storage account create \\\n  --name innoadstg \\\n  --resource-group innoad-rg \\\n  --location eastus\n```\n\n### 2. Configurar App Settings (Backend)\n\n```bash\naz webapp config appsettings set \\\n  --name innoad-backend \\\n  --resource-group innoad-rg \\\n  --settings \\\n  DATABASE_URL=\"jdbc:postgresql://innoad-db.postgres.database.azure.com:5432/innoad_db?sslmode=require\" \\\n  DATABASE_USERNAME=\"postgres@innoad-db\" \\\n  DATABASE_PASSWORD=\"YourSecurePassword123!\" \\\n  REDIS_HOST=\"innoad-redis.redis.cache.windows.net\" \\\n  REDIS_PORT=\"6379\" \\\n  REDIS_PASSWORD=\"<get-from-azure-portal>\" \\\n  JWT_SECRET=\"your_super_secret_key_here\" \\\n  AI_API_KEY=\"sk-your-openai-key\" \\\n  SPRING_PROFILES_ACTIVE=\"prod\"\n```\n\n### 3. Hacer Build y Deploy del Backend\n\n```bash\ncd innoadBackend\n\n# Build JAR\nmvn clean package -DskipTests\n\n# Deploy a Azure\naz webapp deployment source config-zip \\\n  --resource-group innoad-rg \\\n  --name innoad-backend \\\n  --src-path target/innoad-backend-1.0.0.jar\n```\n\n### 4. Deploy del Frontend (Netlify/Vercel)\n\n**Option A: Netlify**\n```bash\ncd innoadFrontend\n\n# Build\nnpm run build\n\n# Deploy (instalar netlify-cli primero)\nnpm install -g netlify-cli\nnetlify deploy --prod --dir=dist/innoad-frontend\n```\n\n**Option B: Vercel**\n```bash\ncd innoadFrontend\n\n# Deploy\nvercel --prod\n```\n\n### 5. Configurar DNS y CORS\n\n**Backend (ConfiguracionSeguridad.java) - HTTPS URLs**\n```java\n.allowedOrigins(\n    \"https://innoad.netlify.app\",\n    \"https://innoad.vercel.app\",\n    \"https://yourdomain.com\"\n)\n```\n\n---\n\n## ‚úÖ Validaci√≥n Post-Deployment\n\n### 1. Health Checks\n\n```bash\n# Backend\ncurl https://innoad-backend.azurewebsites.net/api/health\n# Response: {\"status\":\"UP\"}\n\n# Frontend carga correctamente\nopen https://innoad.netlify.app\n```\n\n### 2. Verificar Componentes Fase 4\n\n**Rate Limiting:**\n```bash\n# Hacer 101 requests r√°pidamente\nfor i in {1..101}; do\n  curl https://innoad-backend.azurewebsites.net/api/chat/test\ndone\n# El 101 debe retornar 429 Too Many Requests\n```\n\n**Redis Cache:**\n```bash\n# Backend debe usar cach√©\ncurl https://innoad-backend.azurewebsites.net/api/config/ia/test\n# Primera vez: fetch from DB + cach√©\n# Segunda vez: fetch from Redis (< 100ms)\n```\n\n**Analytics Dashboard:**\n```bash\n# Navegar a Dashboard en frontend\n# Verificar que se cargan 16 m√©tricas\n# Verificar que se actualizan cada 30 segundos\n# Cambiar per√≠odo (√∫ltima-hora, hoy, semanal)\n```\n\n### 3. Monitoreo\n\n```bash\n# Ver logs en Azure\naz webapp log tail \\\n  --name innoad-backend \\\n  --resource-group innoad-rg\n\n# Monitorear Redis\n# En Azure Portal: innoad-redis ‚Üí Metrics\n\n# Monitorear PostgreSQL\n# En Azure Portal: innoad-db ‚Üí Query Performance\n```\n\n---\n\n## üîê Seguridad en Producci√≥n\n\n### 1. SSL/TLS\n```bash\n# Azure autom√°ticamente proporciona certificado\n# Verificar en Azure Portal: App Service ‚Üí TLS/SSL settings\n```\n\n### 2. Firewall\n```bash\n# PostgreSQL - Permitir solo desde Azure\naz postgres flexible-server firewall-rule create \\\n  --name AllowAzureServices \\\n  --resource-group innoad-rg \\\n  --server-name innoad-db \\\n  --start-ip-address 0.0.0.0 \\\n  --end-ip-address 0.0.0.0\n\n# Redis - Permitir solo desde App Service\n```\n\n### 3. Backups\n```bash\n# PostgreSQL backup autom√°tico\n# En Azure Portal: Set backup retention to 35 days\n\n# Application backup\n# En Azure Portal: App Service ‚Üí Backups\n```\n\n### 4. Secrets Management\n```bash\n# Usar Azure Key Vault\naz keyvault secret set \\\n  --vault-name innoad-kv \\\n  --name JwtSecret \\\n  --value \"your_super_secret_key\"\n\n# Referenciar en App Settings\n# @Microsoft.KeyVault(SecretUri=https://innoad-kv.vault.azure.net/secrets/JwtSecret/)\n```\n\n---\n\n## üìä Monitoreo en Producci√≥n\n\n### 1. Application Insights\n\n```bash\n# Ya incluido en Azure App Service\n# Dashboards autom√°ticos para:\n# - Requests/segundo\n# - Latencia promedio\n# - Error rate\n# - CPU/Memoria\n```\n\n### 2. Custom Metrics (desde Angular)\n\n```typescript\n// En DashboardAnalyticsComponent\nprivate registrarEventoAnalytics(evento: string) {\n  // Enviar a Azure Application Insights\n  this.appInsights.trackEvent({\n    name: evento,\n    properties: { timestamp: new Date().toISOString() }\n  });\n}\n```\n\n### 3. Alertas\n\n```bash\n# En Azure Portal: Monitor ‚Üí Alerts\n# Crear alertas para:\n# - Error rate > 5%\n# - Response time > 2000ms\n# - CPU > 80%\n# - Espacio DB > 90%\n```\n\n---\n\n## üîÑ CI/CD Pipeline (GitHub Actions)\n\n### 1. Crear `.github/workflows/deploy.yml`\n\n```yaml\nname: Deploy to Azure\n\non:\n  push:\n    branches: [main]\n\njobs:\n  build-and-deploy:\n    runs-on: ubuntu-latest\n    \n    steps:\n    - uses: actions/checkout@v3\n    \n    # Build Backend\n    - uses: actions/setup-java@v3\n      with:\n        java-version: 21\n    \n    - name: Build Backend\n      run: |\n        cd innoadBackend\n        mvn clean package -DskipTests\n    \n    # Build Frontend\n    - uses: actions/setup-node@v3\n      with:\n        node-version: 18\n    \n    - name: Build Frontend\n      run: |\n        cd innoadFrontend\n        npm install\n        npm run build\n    \n    # Deploy\n    - name: Deploy to Azure\n      uses: azure/webapps-deploy@v2\n      with:\n        app-name: innoad-backend\n        publish-profile: ${{ secrets.AZURE_PUBLISH_PROFILE }}\n        package: innoadBackend/target/*.jar\n```\n\n### 2. Agregar Secret en GitHub\n```bash\n# En GitHub Repo ‚Üí Settings ‚Üí Secrets\n# AZURE_PUBLISH_PROFILE=<contenido del publish profile>\n```\n\n---\n\n## üìã Rollback en Caso de Error\n\n### 1. Backend Rollback\n```bash\n# Azure mantiene hist√≥rico de deployments\naz webapp deployment slot list \\\n  --name innoad-backend \\\n  --resource-group innoad-rg\n\n# Swapear a versi√≥n anterior\naz webapp deployment slot swap \\\n  --name innoad-backend \\\n  --resource-group innoad-rg \\\n  --slot staging\n```\n\n### 2. Frontend Rollback\n```bash\n# Netlify/Vercel tienen historial de deployments\n# En dashboard: Deployments ‚Üí Seleccionar versi√≥n anterior ‚Üí Restore\n```\n\n### 3. Database Rollback\n```bash\n# PostgreSQL\n# Usar backup autom√°tico (√∫ltimos 35 d√≠as)\naz postgres flexible-server restore \\\n  --name innoad-db \\\n  --resource-group innoad-rg \\\n  --restore-time \"2024-01-15 10:30:00\"\n```\n\n---\n\n## üß™ Testing en Staging\n\nAntes de deployer a producci√≥n:\n\n```bash\n# 1. Run backend tests\ncd innoadBackend\nmvn test\n\n# 2. Run frontend tests\ncd innoadFrontend\nnpm test\n\n# 3. E2E testing (Cypress)\nnpm run e2e\n\n# 4. Load testing (Apache JMeter)\njmeter -n -t load-test.jmx -l results.jtl\n\n# 5. Security scanning (OWASP ZAP)\nzap-cli quick-scan https://staging.innoad.com\n```\n\n---\n\n## üìû Troubleshooting Comunes\n\n### Error: \"Connection refused Redis\"\n**Soluci√≥n:**\n```bash\n# Verificar Redis est√° corriendo\ndocker-compose ps redis\n\n# O en Azure: Verificar redis.azure.com connection\nredis-cli -h innoad-redis.redis.cache.windows.net -a <password> ping\n```\n\n### Error: \"Rate limit exceeded\"\n**Soluci√≥n:**\n```bash\n# Esperar 60 segundos (TTL del contador)\n# O resetear contadores (SUPER_ADMIN only):\nPOST /api/analytics/resetear\n```\n\n### Error: \"JWT token expired\"\n**Soluci√≥n:**\n```bash\n# Frontend hace refresh autom√°tico\n# Si a√∫n falla, re-login:\nPOST /api/auth/login\n```\n\n### Error: \"PostgreSQL connection timeout\"\n**Soluci√≥n:**\n```bash\n# Verificar connection string\n# En Azure: Copiar exactamente desde Portal\n# Agregar ?sslmode=require al final\n```\n\n---\n\n## üìà Scaling en Producci√≥n\n\n### 1. Auto-scaling Backend\n```bash\naz appservice plan update \\\n  --name innoad-plan \\\n  --resource-group innoad-rg \\\n  --enable-auto-scale true\n\naz monitor autoscale create \\\n  --name innoad-autoscale \\\n  --resource-group innoad-rg \\\n  --resource innoad-plan \\\n  --resource-type \"Microsoft.Web/serverFarms\" \\\n  --min-count 2 \\\n  --max-count 5 \\\n  --count 2\n```\n\n### 2. Redis Cache Scaling\n```bash\n# En Azure Portal:\n# innoad-redis ‚Üí Scale ‚Üí Upgrade a Premium\n```\n\n### 3. Database Scaling\n```bash\n# En Azure Portal:\n# innoad-db ‚Üí Compute + Storage ‚Üí Aumentar cores/RAM\n```\n\n---\n\n## ‚úÖ Checklist Pre-Producci√≥n\n\nAntes de deployer:\n\n- [ ] Backend compila sin errores\n- [ ] Frontend builds sin warnings\n- [ ] Todos los tests pasan (mvn test, npm test)\n- [ ] Variables de entorno configuradas\n- [ ] Database migrations ejecutadas\n- [ ] Redis caches configurados\n- [ ] SSL/TLS habilitado\n- [ ] Firewall configurado\n- [ ] Backups habilitados\n- [ ] Monitoreo configurado\n- [ ] Alertas creadas\n- [ ] Load testing pas√≥\n- [ ] Security scan pas√≥\n- [ ] Rollback plan documentado\n- [ ] Team notificado del deployment\n\n---\n\n## üéâ Conclusi√≥n\n\nInnoAd est√° completamente listo para producci√≥n con:\n- ‚úÖ Redis caching (bajo latency)\n- ‚úÖ Rate limiting (protecci√≥n)\n- ‚úÖ Analytics dashboard (monitoreo)\n- ‚úÖ Full CI/CD pipeline\n- ‚úÖ Security hardening\n- ‚úÖ Automatic backups\n- ‚úÖ Auto-scaling\n\n**Happy deploying! üöÄ**\n