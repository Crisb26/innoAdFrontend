# ============================================================================
# PERFIL: SERVIDOR CASERO (Home Server / Self-Hosted)
# ============================================================================
# Activar con: SPRING_PROFILES_ACTIVE=server
# Este perfil se usa cuando se despliega en el servidor casero con Docker Compose
# PostgreSQL corre como contenedor Docker en la misma red
# ============================================================================

spring:
  datasource:
    url: jdbc:postgresql://${DB_HOST:postgres}:${DB_PORT:5432}/${DB_NAME:innoad_db}
    username: ${DB_USER:innoad}
    password: ${DB_PASSWORD:innoad_password_segura_2024}
    driver-class-name: org.postgresql.Driver
    hikari:
      connection-timeout: 30000
      maximum-pool-size: 20
      minimum-idle: 5
      idle-timeout: 600000
      max-lifetime: 1800000
      connection-test-query: SELECT 1
      leak-detection-threshold: 60000

  jpa:
    show-sql: false
    hibernate:
      ddl-auto: update
    properties:
      hibernate:
        jdbc:
          batch_size: 20
          time_zone: America/Bogota
        format_sql: false
        dialect: org.hibernate.dialect.PostgreSQLDialect

  # Correo electronico
  mail:
    host: ${MAIL_HOST:smtp.gmail.com}
    port: ${MAIL_PORT:587}
    username: ${MAIL_USERNAME:}
    password: ${MAIL_PASSWORD:}

  # Redis (opcional - deshabilitado por defecto en servidor casero)
  data:
    redis:
      host: ${REDIS_HOST:redis}
      port: ${REDIS_PORT:6379}
      password: ${REDIS_PASSWORD:}
      timeout: 60000ms

# Logging optimizado para servidor casero
logging:
  level:
    root: WARN
    com.innoad: INFO
    org.springframework.web: WARN
    org.hibernate: WARN
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: /app/logs/innoad-backend.log
    max-size: 50MB
    max-history: 30

# Actuator para health checks
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics
  endpoint:
    health:
      show-details: when-authorized
  health:
    mail:
      enabled: false
    redis:
      enabled: false

# Server configuration
server:
  port: ${PORT:8080}
  tomcat:
    threads:
      max: 200
      min-spare: 20
    connection-timeout: 30s
    max-connections: 5000
    accept-count: 100
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/xml,text/plain
    min-response-size: 1024
  error:
    include-message: always
    include-stacktrace: never

# JWT
jwt:
  secret: ${JWT_SECRET:CAMBIAR_ESTE_SECRETO_EN_PRODUCCION_MINIMO_64_CARACTERES_ABC123}
  expiration: ${JWT_EXPIRATION:86400000}
  refresh-expiration: ${JWT_REFRESH_EXPIRATION:604800000}

# Configuracion de la aplicacion
innoad:
  maintenance:
    security-code: ${MAINTENANCE_CODE:93022611184}
    email-for-recovery: ${MAINTENANCE_EMAIL:admin@innoad.com}

  ai:
    api-url: ${AI_API_URL:https://api.openai.com/v1}
    api-key: ${AI_API_KEY:}
    model: ${AI_MODEL:gpt-4}
    max-tokens: ${AI_MAX_TOKENS:2000}
    temperature: ${AI_TEMPERATURE:0.7}

  frontend:
    url: ${FRONTEND_URL:http://localhost}
    allowed-origins:
      - ${FRONTEND_URL:http://localhost}
      - http://localhost
      - http://localhost:80
      - http://localhost:4200
      - ${SERVER_PUBLIC_URL:http://localhost}

# Mercado Pago
mercado-pago:
  access-token: ${MERCADO_PAGO_ACCESS_TOKEN:}
  public-key: ${MERCADO_PAGO_PUBLIC_KEY:}
  webhook-url: ${MERCADO_PAGO_WEBHOOK_URL:}
  client-id: ${MERCADO_PAGO_CLIENT_ID:}
  client-secret: ${MERCADO_PAGO_CLIENT_SECRET:}

# OpenAI
openai:
  api-key: ${OPENAI_API_KEY:${AI_API_KEY:}}
  api-url: ${OPENAI_API_URL:https://api.openai.com/v1}
  model: ${OPENAI_MODEL:gpt-4}
  max-tokens: ${OPENAI_MAX_TOKENS:2000}
  temperature: ${OPENAI_TEMPERATURE:0.7}
  timeout-seconds: ${OPENAI_TIMEOUT_SECONDS:30}
  max-retries: ${OPENAI_MAX_RETRIES:3}
  retry-delay-ms: ${OPENAI_RETRY_DELAY_MS:1000}

# Email adicional
mail:
  host: ${EMAIL_SMTP_HOST:${MAIL_HOST:smtp.gmail.com}}
  port: ${EMAIL_SMTP_PORT:${MAIL_PORT:587}}
  username: ${EMAIL_SMTP_USER:${MAIL_USERNAME:}}
  password: ${EMAIL_SMTP_PASSWORD:${MAIL_PASSWORD:}}
  from: ${EMAIL_FROM:soporte@innoad.com}
  from-name: ${EMAIL_FROM_NAME:InnoAd - Soporte}
  auth: true
  start-tls-enable: true
  start-tls-required: true
  debug: false
