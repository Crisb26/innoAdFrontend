import { Component, OnInit, OnDestroy } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport { Subject } from 'rxjs';\nimport { takeUntil, interval } from 'rxjs';\nimport { environment } from '../../../environments/environment';\n\n/**\n * Interfaz para estadísticas del sistema\n */\ninterface Estadisticas {\n  // Chat\n  totalMensajesChat: number;\n  totalUsuariosActivos: number;\n  tiempoPromedioRespuestaChat: number;\n\n  // IA\n  totalPreguntasIA: number;\n  totalRespuestasExitosas: number;\n  totalRespuestasError: number;\n  tasaExitoIA: number;\n  tiempoPromedioPreguntaIA: number;\n  tokensUsadosHoy: number;\n  costoHoyIA: number;\n\n  // Sistema\n  usuariosConectados: number;\n  usuariosActivos: number;\n  tasaDisponibilidadSistema: number;\n  tiempoPromedioRespuestaSistema: number;\n  totalSolicitudesProcessadas: number;\n  totalErrores: number;\n\n  // Metadata\n  ultimaActualizacion: string;\n  periodo: string;\n}\n\n/**\n * Componente de Dashboard de Analytics\n * Muestra estadísticas en tiempo real del sistema\n */\n@Component({\n  selector: 'app-dashboard-analytics',\n  standalone: true,\n  imports: [CommonModule],\n  templateUrl: './dashboard-analytics.component.html',\n  styleUrls: ['./dashboard-analytics.component.scss']\n})\nexport class DashboardAnalyticsComponent implements OnInit, OnDestroy {\n\n  estadisticas: Estadisticas | null = null;\n  cargando: boolean = false;\n  error: string = '';\n  periodoSeleccionado: 'ultima-hora' | 'hoy' | 'semanal' = 'ultima-hora';\n\n  private destroy$ = new Subject<void>();\n  private urlApi = environment.api?.baseUrl || 'http://localhost:8080/api';\n\n  constructor(private http: HttpClient) {}\n\n  ngOnInit(): void {\n    // Cargar estadísticas iniciales\n    this.cargarEstadisticas();\n\n    // Recargar cada 30 segundos\n    interval(30000)\n      .pipe(takeUntil(this.destroy$))\n      .subscribe(() => this.cargarEstadisticas());\n  }\n\n  ngOnDestroy(): void {\n    this.destroy$.next();\n    this.destroy$.complete();\n  }\n\n  /**\n   * Carga las estadísticas del servidor\n   */\n  cargarEstadisticas(): void {\n    try {\n      this.cargando = true;\n      this.error = '';\n\n      const endpoint = `${this.urlApi}/analytics/${this.periodoSeleccionado}`;\n\n      this.http.get<Estadisticas>(endpoint)\n        .pipe(takeUntil(this.destroy$))\n        .subscribe({\n          next: (datos) => {\n            this.estadisticas = datos;\n            this.cargando = false;\n          },\n          error: (err) => {\n            this.error = 'Error al cargar estadísticas';\n            this.cargando = false;\n            console.error('Error cargando estadísticas:', err);\n          }\n        });\n    } catch (err) {\n      this.error = 'Error inesperado al cargar estadísticas';\n      this.cargando = false;\n    }\n  }\n\n  /**\n   * Cambia el período de estadísticas\n   */\n  cambiarPeriodo(periodo: 'ultima-hora' | 'hoy' | 'semanal'): void {\n    this.periodoSeleccionado = periodo;\n    this.cargarEstadisticas();\n  }\n\n  /**\n   * Calcula el color basado en porcentaje\n   */\n  obtenerColorPorcentaje(valor: number): string {\n    if (valor >= 90) return '#2ecc71'; // Verde\n    if (valor >= 70) return '#f39c12'; // Naranja\n    return '#e74c3c'; // Rojo\n  }\n\n  /**\n   * Formatea el dinero\n   */\n  formatearDinero(valor: number): string {\n    return `$${valor.toFixed(2)}`;\n  }\n\n  /**\n   * Formatea tiempo en milisegundos\n   */\n  formatearTiempo(ms: number): string {\n    if (ms < 1000) return `${Math.round(ms)}ms`;\n    return `${(ms / 1000).toFixed(2)}s`;\n  }\n}\n